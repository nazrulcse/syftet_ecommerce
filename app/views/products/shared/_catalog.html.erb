<aside class="widget clearfix">
  <div class="widget widget-off">
    <h3 class="widget-title">
      <%= t(:search_catalog) %>
    </h3>

    <div class="widget-filter-wrapper">
      <div class="woof_redraw_zone">
        <div class="price-slider">
          <input class="range-slider hidden" value=''>
        </div>

        <div class="container-inner-filter">
          <h4>Color</h4>

          <div class="widget-block-html-items color-section clearfix">
            <ul class="color-section-ul-style">
              <% color_filters(@taxon).each do |color| %>
                  <li>
                    <%= radio_button_tag :color, color %>
                    <label for="color_<%= color %>">
                      <span style="background:#<%= color %>"></span>
                    </label>
                    <a href="javascript:void(0);" style="display: none;" class="clear-color-filter">
                      <i class="fa fa-times-circle"></i>
                    </a>
                  </li>
              <% end %>
            </ul>
          </div>
        </div>

        <div data-css-class="woof_container_pa_size" class="woof_container woof_container_checkbox woof_container_pa_size woof_container_2 woof_container_size">
          <div class="woof_container_overlay_item"></div>
          <div class="woof_container_inner woof_container_inner_size">
            <h4>Size</h4>

            <div class="widget-block-html-items">
              <ul class="widget-list-checkbox">
                <% size_filters(@taxon).each do |size| %>
                    <li>
                      <%= check_box_tag 'size[]', size, false, {id: "size-#{size}"} %>
                      <label for="size-<%= size %>"> <%= size %> </label>
                    </li>
                <% end %>
              </ul>
            </div>

            <input type="hidden" name="woof_t_pa_size" value="Product Size"><!-- for red button search nav panel -->

          </div>
        </div>
        <div class="woof_submit_search_form_container">
          <a style="float: right;" href="<%= @taxon.present? ? categories_path(@taxon) : products_path %>" class="btn btn-warning reset-border-radius" data-link="">Reset</a>
        </div>
      </div>
    </div>
  </div>
</aside>

<script type="text/javascript">
    $(function () {
        data_query = $.query;
        $(".range-slider").ionRangeSlider({
            type: "double",
            grid: true,
            min: 0,
            max: 1000,
            from: <%= params[:min] || 0 %>,
            to: <%= params[:max] || 1000 %>,
            prefix: "$",
            onFinish: function (data) {
                new_url = data_query.SET('min', data.from).SET('max', data.to);
                loadProducts(new_url);
            }
        });

        $('.color-section-ul-style label').click(function () {
            color = $(this).parent().find("input[type='radio']").val();
            if (typeof color != undefined) {
                new_url = data_query.SET('color', color);
                loadProducts(new_url);
            }
        });

        $('.clear-color-filter').click(function () {
            $('.color-section-ul-style').find("input[type='radio']").prop('checked', false);
            new_url = data_query.REMOVE('color');
            loadProducts(new_url);
        });

        $("input[name='size[]']").click(function () {
            sizes = $("input[name='size[]']:checked").val();
            new_url = data_query.SET('size', sizes);
            loadProducts(new_url);
        });
    });

    function loadProducts(url) {
        $.ajax({
            url: url,
            type: 'get',
            dataType: 'script',
            error: function (e) {
                console.log(e);
                popupMessage('Unable to load product!', 'alert alert-error');
            },
            success: function () {
                window.history.pushState('', 'Products', url);
            }
        })
    }
</script>